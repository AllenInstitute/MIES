FROM debian:bullseye
MAINTAINER Thomas Braun thomas.braun@byte-physics.de

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update &&                          \
    apt-get install -y --no-install-recommends \
      git                                      \
      patch                                    \
      python-is-python3                        \
      python3-minimal                          \
      python3-pip                              \
      python3-setuptools                       \
      python3-wheel &&                         \
    rm -rf /var/lib/apt/lists/*

ARG PACKAGE_WITH_VERSION

RUN pip3 install $PACKAGE_WITH_VERSION

RUN pip3 check

COPY 0001-Support-nwb_version-as-a-fixed-length-string-1669.patch /root

RUN patch -d /usr/local/lib/python3.9/dist-packages                         \
    -p2 </root/0001-Support-nwb_version-as-a-fixed-length-string-1669.patch

ARG USERID
ARG GROUPID

# add normal user
RUN groupadd -g $USERID ci
RUN useradd -u $USERID -g $GROUPID -ms /bin/bash ci

USER ci

WORKDIR /home/ci
