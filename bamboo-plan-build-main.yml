---
oid: 9115426383286248458
key: BM
name: Build main
description: Build the main branch and update documentation and release packages
project:
  oid: 9116411545704726583
  key: MIES
repositories:
- oid: 9115848595751319850
  name: Plan Repository
  description: A Git Repository
  pluginKey: com.atlassian.bamboo.plugins.atlassian-bamboo-plugin-git:gitv2
  server:
    commandTimeout: 180
    useSubmodules: true
    on.cleanCheckout: false
    authenticationType: NONE
    on.cleanWorkingDirectory: false
    verbose.logs: false
    useShallowClones: false
    fetch.whole.repository: true
    useRemoteAgentCache: true
    repositoryUrl: https://github.com/AllenInstitute/MIES
    sitoryViewer: bamboo.webrepositoryviewer.provided:noRepositoryViewer
  branch:
    branch: main
  changeDetectionOptions:
    repository.common.quietPeriod.enabled: true
    repository.common.quietPeriod.period: 120
    repository.common.quietPeriod.maxRetries: 10
    filter.pattern.option: none
    filter.pattern.regex: ''
    changeset.filter.pattern.regex: ''
triggers:
- name: Repository polling
  description: ''
  pluginKey: com.atlassian.bamboo.triggers.atlassian-bamboo-triggers:poll
  enabled: true
  configuration:
    repository.change.poll.pollingPeriod: '180'
    repository.change.poll.type: PERIOD
    repository.change.poll.cronExpression: 0 0 0 ? * *
  triggerConditions:
    com.atlassian.bamboo.triggercondition.internal:plansGreenCondition:
      enabled: 'false'
  triggeringRepositories:
  - 9115848595751319850
branchConfiguration:
  planBranchCreation:
    enabled: false
  removedBranchCleanup:
    enabled: false
  inactiveBranchesCleanup:
    enabled: false
  merging:
    enabled: false
  notificationStrategy: notifyCommitters
  triggers: inherited
  issueLinking: enabled
dependencies:
  configuration:
    enabledForBranches: null
    requireAllStagesPassing: null
    blockingStrategy: none
  childPlans: []
permissions:
  users:
    thomasb:
    - administration
    - build
    - clone
    - read
    - write
  groups: {}
  roles:
    user:
    - read
    anonymous:
    - read
notifications:
- conditionKey: com.atlassian.bamboo.plugin.system.notifications:chainCompleted.failedChains
  conditionConfiguration:
    condition: ''
  recipientKey: com.atlassian.bamboo.plugin.system.notifications:recipient.user
  recipientConfiguration:
    recipient: thomasb
variables:
- name: INSTRUMENT_TESTS
  value: '0'
plugins:
- pluginKey: com.atlassian.bamboo.plugin.system.additionalBuildConfiguration:buildExpiry
  configuration:
    custom.buildExpiryConfig.enabled: 'true'
    custom.buildExpiryConfig.duration: '1'
    custom.buildExpiryConfig.period: weeks
    custom.buildExpiryConfig.buildsToKeep: '1'
    custom.buildExpiryConfig.labelsToKeep: ''
    custom.buildExpiryConfig.expiryTypeArtifact: 'true'
- pluginKey: com.atlassian.bamboo.plugin.artifact.handler.local:artifactHandlersConfiguration
  configuration:
    custom.artifactHandlers.useCustomArtifactHandlers: 'false'
buildDefinition:
  custom:
    com.atlassian.bamboo.plugin.hungbuildkiller:
      stopped.enabled: 'true'
      hung.enabled: 'true'
      add_comment_when_hung.enabled: 'true'
    triggerrCondition.plansGreen.plans: ''
stages:
- oid: 9115567120774610529
  name: Create assets
  jobs:
  - oid: 9115707858262960144
    key: TFR
    name: Test from repo
    tasks:
    - oid: 9116270808216372150
      description: Checkout Default Repository
      pluginKey: com.atlassian.bamboo.plugins.vcs:task.vcs.checkout
      configuration:
        cleanCheckout: true
        repositories:
        - ref: defaultRepository
    - oid: 9116270808216380537
      description: Build started notification
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/send-github-message-build-started.sh'
    - oid: 9116270808216376388
      description: Initial repo config
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: legacy_sh_bat
        script: '"${bamboo.capability.system.builder.command.bash}" tools/initial-repo-config.sh'
    - oid: 9116270808216372151
      description: Clean MIES installation from git
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: legacy_sh_bat
        script: '"${bamboo.capability.system.builder.command.bash}" tools/clean_mies_installation.sh
          -s git'
    - oid: 9116270808216380558
      description: Compilation testing IP9-64bit (with test scripts)
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/check_mies_compilation.sh
          -p Packages/tests/Compilation/CompilationTester.pxp -v IP_9_64'
    - oid: 9116270808216380556
      description: Testing without hardware IP9-64bit
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/autorun-test.sh
          -p Packages/tests/Basic/Basic.pxp -v IP_9_64'
    - oid: 9116270808216376372
      pluginKey: com.atlassian.bamboo.plugins.testresultparser:task.testresultparser.junit
      configuration:
        testResultsDirectory: Packages/tests/**/*.xml
        pickupOutdatedFiles: ''
    - oid: 9116270808216380542
      description: Build finished notification
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      final: true
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/send-github-message-build-finished.sh'
    requirements:
    - key: MIES_AgentType
      matchValue: (ITC|NI|IgorPro)
      matchType: MATCHES
    artifacts:
    - oid: 9116552283193092103
      name: JUNIT logfile
      copyPattern: JU_*.xml
      location: Packages/tests
      shared: false
      subscriptions: []
    - oid: 9116552283193092102
      name: Igor Pro console output
      copyPattern: '**/*.log'
      location: tools
      shared: false
      subscriptions: []
    plugins:
    - pluginKey: com.atlassian.bamboo.plugin.system.build:buildHangingDetection
      configuration:
        custom.buildHangingConfig.enabled: 'true'
        custom.buildHangingConfig.minutesBetweenLogs: '120'
        custom.buildHangingConfig.multiplier: '2.5'
        custom.buildHangingConfig.minutesQueueTimeout: '1440'
    - pluginKey: com.atlassian.bamboo.plugin.clover:cloverResultCollector
      configuration:
        custom.clover.path: ''
        custom.clover.useLocalLicenseKey: 'true'
        custom.clover.license: ''
    buildDefinition:
      cleanWorkingDirectory: false
      repositoryDefiningWorkingDirectory: -1
      custom:
        auto:
          regex: ''
          label: ''
        ncover.path: ''
  - oid: 9115707858262960143
    key: DD
    name: Documentation (Docker)
    tasks:
    - oid: 9116270808216372145
      description: Checkout Default Repository
      pluginKey: com.atlassian.bamboo.plugins.vcs:task.vcs.checkout
      configuration:
        cleanCheckout: true
        repositories:
        - ref: defaultRepository
    - oid: 9116270808216380539
      description: Build started notification
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/send-github-message-build-started.sh'
    - oid: 9116270808216376390
      description: Initial repo config
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: legacy_sh_bat
        script: '"${bamboo.capability.system.builder.command.bash}" tools/initial-repo-config.sh'
    - oid: 9116270808216372146
      description: Build documentation
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/docker/build-documentation.sh'
    - oid: 9116270808216380597
      pluginKey: com.atlassian.bamboo.plugins.testresultparser:task.testresultparser.junit
      configuration:
        testResultsDirectory: Packages/tests/*.xml
        pickupOutdatedFiles: ''
    - oid: 9116270808216380544
      description: Build finished notification
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      final: true
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/send-github-message-build-finished.sh'
    requirements:
    - key: MIES_AgentType
      matchValue: Linux
      matchType: EQUALS
    artifacts:
    - oid: 9116552283193092101
      name: Documentation
      copyPattern: '*.zip'
      location: Packages/doc
      shared: true
      subscriptions:
      - job: 9115707858262960140
        destination: ''
    buildDefinition:
      cleanWorkingDirectory: false
      repositoryDefiningWorkingDirectory: -1
  - oid: 9115707858262960142
    key: IRP
    name: Installer and release packages
    tasks:
    - oid: 9116270808216372150
      description: Checkout Default Repository
      pluginKey: com.atlassian.bamboo.plugins.vcs:task.vcs.checkout
      configuration:
        cleanCheckout: true
        repositories:
        - ref: defaultRepository
    - oid: 9116270808216380537
      description: Build started notification
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/send-github-message-build-started.sh'
    - oid: 9116270808216376388
      description: Initial repo config
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: legacy_sh_bat
        script: '"${bamboo.capability.system.builder.command.bash}" tools/initial-repo-config.sh'
    - oid: 9116270808216380590
      description: Create release package and installer
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/create-installer.sh'
    - oid: 9116270808216382523
      description: Sign installer
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/sign-installer.sh'
    - oid: 9116270808216380594
      description: Mark job as success
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/set-bamboo-job-result.sh
          -r 0'
    - oid: 9116270808216380598
      pluginKey: com.atlassian.bamboo.plugins.testresultparser:task.testresultparser.junit
      configuration:
        testResultsDirectory: Packages/tests/*.xml
        pickupOutdatedFiles: ''
    - oid: 9116270808216380542
      description: Build finished notification
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      final: true
      configuration:
        interpreter: run_as_executable
        script: '"${bamboo.capability.system.builder.command.bash}" tools/send-github-message-build-finished.sh'
    requirements:
    - key: MIES_AgentType
      matchValue: CodeSigning
      matchType: EQUALS
    artifacts:
    - oid: 9116552283193092099
      name: Release package
      copyPattern: '*.zip'
      location: ''
      shared: true
      subscriptions:
      - job: 9115707858262960141
        destination: ''
    - oid: 9116552283193092100
      name: Installer
      copyPattern: MIES-*.exe
      location: tools/installer
      shared: true
      subscriptions:
      - job: 9115707858262960141
        destination: ''
    plugins:
    - pluginKey: com.atlassian.bamboo.plugin.system.build:buildHangingDetection
      configuration:
        custom.buildHangingConfig.enabled: 'true'
        custom.buildHangingConfig.minutesBetweenLogs: '10'
        custom.buildHangingConfig.multiplier: '2.5'
        custom.buildHangingConfig.minutesQueueTimeout: '1440'
    - pluginKey: com.atlassian.bamboo.plugin.clover:cloverResultCollector
      configuration:
        custom.clover.path: ''
        custom.clover.useLocalLicenseKey: 'true'
        custom.clover.license: ''
    buildDefinition:
      cleanWorkingDirectory: false
      repositoryDefiningWorkingDirectory: -1
      custom:
        auto:
          regex: ''
          label: ''
        ncover.path: ''
- oid: 9115567120774610371
  name: Uploading assets
  jobs:
  - oid: 9115707858262960140
    key: BUD
    name: Uploading the documentation
    tasks:
    - oid: 9116270808216372145
      description: Checkout Default Repository
      pluginKey: com.atlassian.bamboo.plugins.vcs:task.vcs.checkout
      configuration:
        cleanCheckout: true
        repositories:
        - ref: defaultRepository
    - oid: 9116270808216376399
      description: Initial repo config
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: legacy_sh_bat
        script: '"${bamboo.capability.system.builder.command.bash}" tools/initial-repo-config.sh'
    - oid: 9116270808216372147
      description: Deploy documentation to github pages
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: legacy_sh_bat
        scriptLocation: tools/publish-docs-on-github.sh
    requirements:
    - key: MIES_AgentType
      matchValue: Linux
      matchType: MATCHES
    buildDefinition:
      cleanWorkingDirectory: false
      repositoryDefiningWorkingDirectory: -1
  - oid: 9115707858262960141
    key: UP
    name: Uploading the installer and release package to github
    tasks:
    - oid: 9116270808216372145
      description: Checkout Default Repository
      pluginKey: com.atlassian.bamboo.plugins.vcs:task.vcs.checkout
      configuration:
        cleanCheckout: true
        repositories:
        - ref: defaultRepository
    - oid: 9116270808216376399
      description: Initial repo config
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: legacy_sh_bat
        script: '"${bamboo.capability.system.builder.command.bash}" tools/initial-repo-config.sh'
    - oid: 9116270808216372147
      description: Deploy release assets to github
      pluginKey: com.atlassian.bamboo.plugins.scripttask:task.builder.script
      configuration:
        interpreter: legacy_sh_bat
        scriptLocation: tools/upload-github-release-asset.sh
    requirements:
    - key: MIES_AgentType
      matchValue: Linux
      matchType: EQUALS
    buildDefinition:
      cleanWorkingDirectory: false
      repositoryDefiningWorkingDirectory: -1
...
